# Base URL: http://127.0.0.1:8787 (wrangler dev must be running)
# Flow: Login -> token auto-resolved -> call endpoints with Authorization: Bearer {{authToken}}

@base = http://127.0.0.1:8787

### 1) Login as admin (token auto-saved to {{authToken}})
# @name login
POST {{base}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "admin@edu.com",
  "password": "Admin123"
}

### Set the Auth Token
@authToken = {{login.response.body.token}}

### 2) Run manual scheduler for a specific month (omit month to use current)
# @name runScheduler
POST {{base}}/api/v1/admin/sessions/schedule
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "month": "2026-01"
}

### 3) List sessions (verify creation)
# @name listSessions
GET {{base}}/api/v1/admin/sessions
Authorization: Bearer {{authToken}}

### 4) Trigger local scheduled handler (wrangler dev --test-scheduled)
# @name triggerScheduledLocal
GET {{base}}/__scheduled?cron=*+*+*+*+*

### 5) Delete sessions for a month (revert)
# @name deleteSessionsMonth
DELETE {{base}}/api/v1/admin/sessions/by-month
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "month": "2026-01"
}

### 6) Verify deletion
# @name verifyDeletion
GET {{base}}/api/v1/admin/sessions
Authorization: Bearer {{authToken}}
